<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="~/Styles/chatStyle.css" rel="stylesheet" />

</head>
<body>
    <input type="text" placeholder="Message" id="messText" />
    <input type="button" value="Send" id="messInput" />
    <div>
       @* <ul id="Messages"></ul>*@
    </div>

    <div class="col-sm-3 col-sm-offset-4 frame">
        <ul></ul>
        <div>
            <div class="msj-rta macro">
                <div class="text text-r" style="background:whitesmoke !important">
                    <input class="mytext" type="text" id="messText" placeholder="Type a message" />
                </div>
            </div>
            <div style="padding:10px;">
                <span class="glyphicon glyphicon-share-alt"></span>
            </div>
        </div>
    </div>




    @section Scripts{
        <script src="~/Scripts/jquery-1.6.4.min.js"></script>
        <script src="~/Scripts/jquery.signalR-2.1.2.js"></script>
        <script src="~/signalr/hubs"></script>
        <script>
            var chatProxy = $.connection.Chat;


            $.connection.hub.start().done(function () {
                // Wire up Send button to call NewContosoChatMessage on the server.
                $('#messInput').click(function () {
                    chatProxy.server.sendmessage($("#messText").val(),
                       2 ,
                        @Session["user_id"]);
                    $('#messText').val('').focus();
                });

            });
            chatProxy.client.send = function (message) {
                console.log("Client method");
                $('#Messages').append('<li>' + message + '</li>');


            }


        </script>

        <script>
            var me = {};
            me.avatar = "https://lh6.googleusercontent.com/-lr2nyjhhjXw/AAAAAAAAAAI/AAAAAAAARmE/MdtfUmC0M4s/photo.jpg?sz=48";

            var you = {};
            you.avatar = "https://a11.t26.net/taringa/avatares/9/1/2/F/7/8/Demon_King1/48x48_5C5.jpg";

            //get time Now 
            function formatAMPM(date) {
                var hours = date.getHours();
                var minutes = date.getMinutes();
                var ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12; // the hour '0' should be '12'
                minutes = minutes < 10 ? '0' + minutes : minutes;
                var strTime = hours + ':' + minutes + ' ' + ampm;
                return strTime;
            } 

            function insertChat(who, text, time) {
                if (time === undefined) {
                    time = 0;
                }
                var control = "";
                var date = formatAMPM(new Date());

                if (who == "me") {
                    control = '<li style="width:100%">' +
                        '<div class="msj macro">' +
                        '<div class="avatar"><img class="img-circle" style="width:100%;" src="' + me.avatar + '" /></div>' +
                        '<div class="text text-l">' +
                        '<p>' + text + '</p>' +
                        '<p><small>' + date + '</small></p>' +
                        '</div>' +
                        '</div>' +
                        '</li>';
                } else {
                    control = '<li style="width:100%;">' +
                        '<div class="msj-rta macro">' +
                        '<div class="text text-r">' +
                        '<p>' + text + '</p>' +
                        '<p><small>' + date + '</small></p>' +
                        '</div>' +
                        '<div class="avatar" style="padding:0px 0px 0px 10px !important"><img class="img-circle" style="width:100%;" src="' + you.avatar + '" /></div>' +
                        '</li>';
                }
                setTimeout(
                    function () {
                        $("ul").append(control).scrollTop($("ul").prop('scrollHeight'));
                    }, time);

            }

            function resetChat() {
                $("ul").empty();
            }

            //$(".mytext").on("keydown", function (e) {
            //    if (e.which == 13) {
            //        var text = $(this).val();
            //        if (text !== "") {
            //            insertChat("me", text);
            //            $(this).val('');
            //        }
            //    }
            //});

            $('body > div > div > div:nth-child(2) > span').click(function () {
                $(".mytext").trigger({ type: 'keydown', which: 13, keyCode: 13 });
            })

            //-- Clear Chat
            resetChat();

            //-- Print Messages
            insertChat("me", "Hello Tom...", 0);
            insertChat("you", "Hi, Pablo", 1500);
            insertChat("me", "What would you like to talk about today?", 3500);
            insertChat("you", "Tell me a joke", 7000);
            insertChat("me", "Spaceman: Computer! Computer! Do we bring battery?!", 9500);


        </script>
    }
</body>
</html>